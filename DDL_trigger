USE AdventureWorksDW2019;

-- Loo trigger, mis reageerib tabeli loomisele
CREATE TRIGGER trmyfirsttrigger
ON DATABASE
FOR CREATE_TABLE
AS
BEGIN 
    PRINT 'loodi uus tabel';
END;

-- Muudame triggerit: keelab tabelite loomise, muutmise ja kustutamise
ALTER TRIGGER trmyfirsttrigger
ON DATABASE 
FOR CREATE_TABLE, ALTER_TABLE, DROP_TABLE
AS
BEGIN
    ROLLBACK;
    PRINT 'sa ei tohi tabeleid teha ega muuta';
END;

-- Keela trigger
DISABLE TRIGGER trmyfirsttrigger ON DATABASE;


DROP TRIGGER trmyfirsttrigger ON DATABASE;


-- Trigger, mis teavitab, kui midagi nimetatakse ümber
CREATE TRIGGER trrenametable
ON DATABASE
FOR RENAME
AS
BEGIN
    PRINT 'sa muutsid midagi nimega';
END;

-- Näide tabeli ja veeru ümbernimetamisest
EXEC sp_rename 'testtable', 'newtesttable';
EXEC sp_rename 'newtesttable.id', 'newid', 'COLUMN';

-- Keelab tabelite loomise ja muutmise konkreetses andmebaasis
CREATE TRIGGER tr_databasescopetrigger 
ON DATABASE
FOR CREATE_TABLE, ALTER_TABLE, DROP_TABLE
AS
BEGIN
    ROLLBACK;
    PRINT 'ei saa siia tabeleid teha ega muuta';
END;


-- Keelab tabelite loomise ja muutmise kogu serveris
CREATE TRIGGER tr_serverscopetrigger
ON ALL SERVER
FOR CREATE_TABLE, ALTER_TABLE, DROP_TABLE
AS
BEGIN
    ROLLBACK;
    PRINT 'ei saa tabeleid teha ega muuta serveris';
END;

-- Keela trigger kogu serveris
DISABLE TRIGGER tr_serverscopetrigger ON ALL SERVER;

-- Luba trigger kogu serveris
ENABLE TRIGGER tr_serverscopetrigger ON ALL SERVER;

-- Kustuta trigger kogu serveris
DROP TRIGGER tr_serverscopetrigger ON ALL SERVER;
